<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JetPack</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="踩坑之路">
    
    <link rel="preload" href="/StudyRecord/assets/css/0.styles.f8b596a9.css" as="style"><link rel="preload" href="/StudyRecord/assets/js/app.9fe21fb7.js" as="script"><link rel="preload" href="/StudyRecord/assets/js/2.711b5d2d.js" as="script"><link rel="preload" href="/StudyRecord/assets/js/12.94471144.js" as="script"><link rel="prefetch" href="/StudyRecord/assets/js/10.b83bebe1.js"><link rel="prefetch" href="/StudyRecord/assets/js/11.512f05a2.js"><link rel="prefetch" href="/StudyRecord/assets/js/13.b9ed5b42.js"><link rel="prefetch" href="/StudyRecord/assets/js/14.fbefe1ec.js"><link rel="prefetch" href="/StudyRecord/assets/js/15.af1daab4.js"><link rel="prefetch" href="/StudyRecord/assets/js/16.577c7a81.js"><link rel="prefetch" href="/StudyRecord/assets/js/17.17e4b2f4.js"><link rel="prefetch" href="/StudyRecord/assets/js/3.546ba140.js"><link rel="prefetch" href="/StudyRecord/assets/js/4.b7d0708f.js"><link rel="prefetch" href="/StudyRecord/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/StudyRecord/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/StudyRecord/assets/js/7.f39602d3.js"><link rel="prefetch" href="/StudyRecord/assets/js/8.1e324f54.js"><link rel="prefetch" href="/StudyRecord/assets/js/9.0259aab8.js">
    <link rel="stylesheet" href="/StudyRecord/assets/css/0.styles.f8b596a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/StudyRecord/" class="home-link router-link-active"><img src="/StudyRecord/imgs/logo.png" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Android Menu" class="dropdown-title"><span class="title">Android</span> <span class="arrow down"></span></button> <button type="button" aria-label="Android Menu" class="mobile-dropdown-title"><span class="title">Android</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Jetpack
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/AndroidView.html" class="nav-link">
  Android常用控件
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/Dependency.html" class="nav-link">
  Android常用依赖
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/AndroidOpenRes.html" class="nav-link">
  Android开源库
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/ErrorCollection.html" class="nav-link">
  Android错误收集
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/network.html" class="nav-link">
  Android Network
</a></li></ul></div></div><div class="nav-item"><a href="/StudyRecord/guide/js/" class="nav-link">
  JS
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/vue/VuePress.html" class="nav-link">
  VuePress
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/vue/Yarn.html" class="nav-link">
  Yarn
</a></li></ul></div></div> <a href="https://github.com/GaoYingjie1995/StudyRecord" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Android Menu" class="dropdown-title"><span class="title">Android</span> <span class="arrow down"></span></button> <button type="button" aria-label="Android Menu" class="mobile-dropdown-title"><span class="title">Android</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Jetpack
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/AndroidView.html" class="nav-link">
  Android常用控件
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/Dependency.html" class="nav-link">
  Android常用依赖
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/AndroidOpenRes.html" class="nav-link">
  Android开源库
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/ErrorCollection.html" class="nav-link">
  Android错误收集
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/android/network.html" class="nav-link">
  Android Network
</a></li></ul></div></div><div class="nav-item"><a href="/StudyRecord/guide/js/" class="nav-link">
  JS
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/vue/VuePress.html" class="nav-link">
  VuePress
</a></li><li class="dropdown-item"><!----> <a href="/StudyRecord/guide/vue/Yarn.html" class="nav-link">
  Yarn
</a></li></ul></div></div> <a href="https://github.com/GaoYingjie1995/StudyRecord" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Android</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/StudyRecord/guide/android/" aria-current="page" class="active sidebar-link">JetPack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#向项目中添加组件" class="sidebar-link">向项目中添加组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#声明依赖项" class="sidebar-link">声明依赖项</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#kotlin" class="sidebar-link">kotlin</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#java" class="sidebar-link">java</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#safe-args" class="sidebar-link">Safe Args</a></li></ul></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#配置编译器选项" class="sidebar-link">配置编译器选项</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#viewbinding" class="sidebar-link">ViewBinding</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#viewbinding-设置" class="sidebar-link">ViewBinding 设置</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#activity中用法" class="sidebar-link">Activity中用法</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#fragment中用法" class="sidebar-link">Fragment中用法</a></li></ul></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#livedata概览" class="sidebar-link">LiveData概览</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#创建livedata" class="sidebar-link">创建LiveData</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#观察livedata" class="sidebar-link">观察LiveData</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#转换livedata" class="sidebar-link">转换LiveData</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#合并多个-livedata-源" class="sidebar-link">合并多个 LiveData 源</a></li></ul></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#viewmodel" class="sidebar-link">ViewModel</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#viewmodel-生命周期" class="sidebar-link">ViewModel 生命周期</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#viewmodel-实例对象的获取方式" class="sidebar-link">ViewModel 实例对象的获取方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#lifecycle" class="sidebar-link">Lifecycle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#defaultlifecycleobserver" class="sidebar-link">DefaultLifecycleObserver</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#lifecycleowner" class="sidebar-link">LifecycleOwner</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#实现自定义-lifecycleowner" class="sidebar-link">实现自定义 LifecycleOwner</a></li></ul></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#navigation" class="sidebar-link">Navigation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#向-activity-添加-navhost" class="sidebar-link">向 Activity 添加 NavHost</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#通过-xml-添加-navhostfragment" class="sidebar-link">通过 XML 添加 NavHostFragment</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#导航到目的地" class="sidebar-link">导航到目的地</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#目的地之间传递数据" class="sidebar-link">目的地之间传递数据</a></li><li class="sidebar-sub-header"><a href="/StudyRecord/guide/android/#嵌套图-多返回栈" class="sidebar-link">嵌套图 多返回栈</a></li></ul></li></ul></li><li><a href="/StudyRecord/guide/android/AndroidView.html" class="sidebar-link">Android常用控件</a></li><li><a href="/StudyRecord/guide/android/Dependency.html" class="sidebar-link">Android 常用依赖</a></li><li><a href="/StudyRecord/guide/android/AndroidOpenRes.html" class="sidebar-link">Android 开源项目</a></li><li><a href="/StudyRecord/guide/android/ErrorCollection.html" class="sidebar-link">Android 异常收集</a></li><li><a href="/StudyRecord/guide/android/network.html" class="sidebar-link">Android 网络库</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jetpack"><a href="#jetpack" class="header-anchor">#</a> JetPack</h1> <h2 id="向项目中添加组件"><a href="#向项目中添加组件" class="header-anchor">#</a> 向项目中添加组件</h2> <p>架构组件可从 Google 的 Maven 代码库中获得。为了使用这些组件，您必须将代码库添加到项目中。</p> <p>打开<strong>项目</strong>的 <code>build.gradle</code> 文件（而不是应用或模块的该文件）并添加 <code>google()</code> 代码库，如下所示：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>allprojects <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="声明依赖项"><a href="#声明依赖项" class="header-anchor">#</a> 声明依赖项</h3> <ul><li><p><a href="https://developer.android.google.cn/jetpack/androidx/releases/concurrent" target="_blank" rel="noopener noreferrer">Futures（可在 androidx.concurrent 中找到）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    implementation <span class="token string gstring">&quot;androidx.concurrent:concurrent-futures:1.1.0&quot;</span>

    <span class="token comment">// Kotlin</span>
    implementation <span class="token string gstring">&quot;androidx.concurrent:concurrent-futures-ktx:1.1.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><a href="https://developer.android.google.cn/jetpack/androidx/releases/lifecycle" target="_blank" rel="noopener noreferrer">生命周期组件（包括 ViewModel）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="kotlin"><a href="#kotlin" class="header-anchor">#</a> kotlin</h3> <div class="language-groovy extra-class"><pre class="language-groovy"><code>    dependencies <span class="token punctuation">{</span>
        <span class="token keyword">def</span> lifecycle_version <span class="token operator">=</span> <span class="token string gstring">&quot;2.4.0&quot;</span>
        <span class="token keyword">def</span> arch_version <span class="token operator">=</span> <span class="token string gstring">&quot;2.1.0&quot;</span>

        <span class="token comment">// ViewModel</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-viewmodel-ktx:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>
        <span class="token comment">// ViewModel utilities for Compose</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-viewmodel-compose:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>
        <span class="token comment">// LiveData</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-livedata-ktx:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>
        <span class="token comment">// Lifecycles only (without ViewModel or LiveData)</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-runtime-ktx:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// Saved state module for ViewModel</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-viewmodel-savedstate:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// Annotation processor</span>
        kapt <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-compiler:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>
        <span class="token comment">// alternately - if using Java8, use the following instead of lifecycle-compiler</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-common-java8:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// optional - helpers for implementing LifecycleOwner in a Service</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-service:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// optional - ProcessLifecycleOwner provides a lifecycle for the whole application process</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-process:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// optional - ReactiveStreams support for LiveData</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-reactivestreams-ktx:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// optional - Test helpers for LiveData</span>
        testImplementation <span class="token string gstring">&quot;androidx.arch.core:core-testing:<span class="token expression"><span class="token punctuation">$</span>arch_version</span>&quot;</span>
    <span class="token punctuation">}</span>
    
</code></pre></div><h3 id="java"><a href="#java" class="header-anchor">#</a> java</h3> <div class="language-groovy extra-class"><pre class="language-groovy"><code>    dependencies <span class="token punctuation">{</span>
        <span class="token keyword">def</span> lifecycle_version <span class="token operator">=</span> <span class="token string gstring">&quot;2.4.0&quot;</span>
        <span class="token keyword">def</span> arch_version <span class="token operator">=</span> <span class="token string gstring">&quot;2.1.0&quot;</span>

        <span class="token comment">// ViewModel</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-viewmodel:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>
        <span class="token comment">// LiveData</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-livedata:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>
        <span class="token comment">// Lifecycles only (without ViewModel or LiveData)</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-runtime:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// Saved state module for ViewModel</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-viewmodel-savedstate:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// Annotation processor</span>
        annotationProcessor <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-compiler:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>
        <span class="token comment">// alternately - if using Java8, use the following instead of lifecycle-compiler</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-common-java8:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// optional - helpers for implementing LifecycleOwner in a Service</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-service:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// optional - ProcessLifecycleOwner provides a lifecycle for the whole application process</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-process:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// optional - ReactiveStreams support for LiveData</span>
        implementation <span class="token string gstring">&quot;androidx.lifecycle:lifecycle-reactivestreams:<span class="token expression"><span class="token punctuation">$</span>lifecycle_version</span>&quot;</span>

        <span class="token comment">// optional - Test helpers for LiveData</span>
        testImplementation <span class="token string gstring">&quot;androidx.arch.core:core-testing:<span class="token expression"><span class="token punctuation">$</span>arch_version</span>&quot;</span>
    <span class="token punctuation">}</span>
    
</code></pre></div></li> <li><p><a href="https://developer.android.google.cn/jetpack/androidx/releases/navigation" target="_blank" rel="noopener noreferrer">导航（包括 SafeArgs）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在应用或模块的 <code>build.gradle</code> 文件中添加所需工件的依赖项：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
  <span class="token keyword">def</span> nav_version <span class="token operator">=</span> <span class="token string gstring">&quot;2.3.5&quot;</span>

  <span class="token comment">// Java language implementation</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-fragment:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-ui:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>

  <span class="token comment">// Kotlin</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-fragment-ktx:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-ui-ktx:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>

  <span class="token comment">// Feature module Support</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-dynamic-features-fragment:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>

  <span class="token comment">// Testing Navigation</span>
  androidTestImplementation <span class="token string gstring">&quot;androidx.navigation:navigation-testing:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>

  <span class="token comment">// Jetpack Compose Integration</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-compose:2.4.0-rc01&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="safe-args"><a href="#safe-args" class="header-anchor">#</a> Safe Args</h3> <p>如需将 <a href="https://developer.android.google.cn/topic/libraries/architecture/navigation/navigation-pass-data#Safe-args" target="_blank" rel="noopener noreferrer">Safe Args<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 添加到您的项目，请在顶层 <code>build.gradle</code> 文件中包含以下 <code>classpath</code>：</p> <p><a href="https://developer.android.google.cn/jetpack/androidx/releases/navigation#groovy" target="_blank" rel="noopener noreferrer">Groovy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://developer.android.google.cn/jetpack/androidx/releases/navigation#kotlin" target="_blank" rel="noopener noreferrer">Kotlin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>buildscript <span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        <span class="token function">google</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    dependencies <span class="token punctuation">{</span>
        <span class="token keyword">def</span> nav_version <span class="token operator">=</span> <span class="token string gstring">&quot;2.3.5&quot;</span>
        classpath <span class="token string gstring">&quot;androidx.navigation:navigation-safe-args-gradle-plugin:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>您还必须应用以下两个可用插件之一。</p> <p>如需生成适用于 Java 模块或 Java 和 Kotlin 混合模块的 Java 语言代码，请将以下行添加到<strong>应用或模块</strong>的 <code>build.gradle</code> 文件中：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span>
  id <span class="token string">'androidx.navigation.safeargs'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此外，如需生成适用于仅 Kotlin 模块的 Kotlin 语言代码，请添加以下行：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>plugins <span class="token punctuation">{</span>
  id <span class="token string">'androidx.navigation.safeargs.kotlin'</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><a href="https://developer.android.google.cn/jetpack/androidx/releases/paging" target="_blank" rel="noopener noreferrer">Paging<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
  <span class="token keyword">def</span> paging_version <span class="token operator">=</span> <span class="token string gstring">&quot;3.1.0&quot;</span>

  implementation <span class="token string gstring">&quot;androidx.paging:paging-runtime:<span class="token expression"><span class="token punctuation">$</span>paging_version</span>&quot;</span>

  <span class="token comment">// alternatively - without Android dependencies for tests</span>
  testImplementation <span class="token string gstring">&quot;androidx.paging:paging-common:<span class="token expression"><span class="token punctuation">$</span>paging_version</span>&quot;</span>

  <span class="token comment">// optional - RxJava2 support</span>
  implementation <span class="token string gstring">&quot;androidx.paging:paging-rxjava2:<span class="token expression"><span class="token punctuation">$</span>paging_version</span>&quot;</span>

  <span class="token comment">// optional - RxJava3 support</span>
  implementation <span class="token string gstring">&quot;androidx.paging:paging-rxjava3:<span class="token expression"><span class="token punctuation">$</span>paging_version</span>&quot;</span>

  <span class="token comment">// optional - Guava ListenableFuture support</span>
  implementation <span class="token string gstring">&quot;androidx.paging:paging-guava:<span class="token expression"><span class="token punctuation">$</span>paging_version</span>&quot;</span>

  <span class="token comment">// optional - Jetpack Compose integration</span>
  implementation <span class="token string gstring">&quot;androidx.paging:paging-compose:1.0.0-alpha14&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><a href="https://developer.android.google.cn/jetpack/androidx/releases/room" target="_blank" rel="noopener noreferrer">Room<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Room 的依赖项包括<a href="https://developer.android.google.cn/training/data-storage/room#db-migration-testing" target="_blank" rel="noopener noreferrer">测试 Room 迁移<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和 <a href="https://developer.android.google.cn/training/data-storage/room/accessing-data#query-rxjava" target="_blank" rel="noopener noreferrer">Room RxJava<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>在应用或模块的 <code>build.gradle</code> 文件中添加所需工件的依赖项：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    <span class="token keyword">def</span> room_version <span class="token operator">=</span> <span class="token string gstring">&quot;2.4.0&quot;</span>

    implementation <span class="token string gstring">&quot;androidx.room:room-runtime:<span class="token expression"><span class="token punctuation">$</span>room_version</span>&quot;</span>
    annotationProcessor <span class="token string gstring">&quot;androidx.room:room-compiler:<span class="token expression"><span class="token punctuation">$</span>room_version</span>&quot;</span>

    <span class="token comment">// optional - RxJava2 support for Room</span>
    implementation <span class="token string gstring">&quot;androidx.room:room-rxjava2:<span class="token expression"><span class="token punctuation">$</span>room_version</span>&quot;</span>

    <span class="token comment">// optional - RxJava3 support for Room</span>
    implementation <span class="token string gstring">&quot;androidx.room:room-rxjava3:<span class="token expression"><span class="token punctuation">$</span>room_version</span>&quot;</span>

    <span class="token comment">// optional - Guava support for Room, including Optional and ListenableFuture</span>
    implementation <span class="token string gstring">&quot;androidx.room:room-guava:<span class="token expression"><span class="token punctuation">$</span>room_version</span>&quot;</span>

    <span class="token comment">// optional - Test helpers</span>
    testImplementation <span class="token string gstring">&quot;androidx.room:room-testing:<span class="token expression"><span class="token punctuation">$</span>room_version</span>&quot;</span>

    <span class="token comment">// optional - Paging 3 Integration</span>
    implementation <span class="token string gstring">&quot;androidx.room:room-paging:2.4.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如需了解如何使用 Kotlin 扩展，请参阅 <a href="https://developer.android.google.cn/kotlin/ktx" target="_blank" rel="noopener noreferrer">ktx 文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>如需详细了解依赖项，请参阅<a href="https://developer.android.google.cn/studio/build/dependencies" target="_blank" rel="noopener noreferrer">添加构建依赖项<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="配置编译器选项"><a href="#配置编译器选项" class="header-anchor">#</a> 配置编译器选项</h2> <p>Room 具有以下注解处理器选项：</p> <ul><li><code>room.schemaLocation</code>：配置并启用将数据库架构导出到给定目录中的 JSON 文件的功能。如需了解详情，请参阅 <a href="https://developer.android.google.cn/training/data-storage/room/migrating-db-versions#export-schema" target="_blank" rel="noopener noreferrer">Room 迁移<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li><code>room.incremental</code>：启用 Gradle 增量注解处理器。</li> <li><code>room.expandProjection</code>：配置 Room 以重写查询，使其顶部星形投影在展开后仅包含 DAO 方法返回类型中定义的列。</li></ul> <p>以下代码段举例说明了如何配置这些选项：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
    <span class="token punctuation">...</span>
    defaultConfig <span class="token punctuation">{</span>
        <span class="token punctuation">...</span>
        javaCompileOptions <span class="token punctuation">{</span>
            annotationProcessorOptions <span class="token punctuation">{</span>
                arguments <span class="token operator">+=</span> <span class="token punctuation">[</span>
                    <span class="token string gstring">&quot;room.schemaLocation&quot;</span><span class="token punctuation">:</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span>projectDir</span>/schemas&quot;</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string gstring">&quot;room.incremental&quot;</span><span class="token punctuation">:</span><span class="token string gstring">&quot;true&quot;</span><span class="token punctuation">,</span>
                    <span class="token string gstring">&quot;room.expandProjection&quot;</span><span class="token punctuation">:</span><span class="token string gstring">&quot;true&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><a href="https://developer.android.google.cn/jetpack/androidx/releases/work" target="_blank" rel="noopener noreferrer">WorkManager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code>dependencies <span class="token punctuation">{</span>
    <span class="token keyword">def</span> work_version <span class="token operator">=</span> <span class="token string gstring">&quot;2.7.1&quot;</span>

    <span class="token comment">// (Java only)</span>
    implementation <span class="token string gstring">&quot;androidx.work:work-runtime:<span class="token expression"><span class="token punctuation">$</span>work_version</span>&quot;</span>

    <span class="token comment">// Kotlin + coroutines</span>
    implementation <span class="token string gstring">&quot;androidx.work:work-runtime-ktx:<span class="token expression"><span class="token punctuation">$</span>work_version</span>&quot;</span>

    <span class="token comment">// optional - RxJava2 support</span>
    implementation <span class="token string gstring">&quot;androidx.work:work-rxjava2:<span class="token expression"><span class="token punctuation">$</span>work_version</span>&quot;</span>

    <span class="token comment">// optional - GCMNetworkManager support</span>
    implementation <span class="token string gstring">&quot;androidx.work:work-gcm:<span class="token expression"><span class="token punctuation">$</span>work_version</span>&quot;</span>

    <span class="token comment">// optional - Test helpers</span>
    androidTestImplementation <span class="token string gstring">&quot;androidx.work:work-testing:<span class="token expression"><span class="token punctuation">$</span>work_version</span>&quot;</span>

    <span class="token comment">// optional - Multiprocess support</span>
    implementation <span class="token string gstring">&quot;androidx.work:work-multiprocess:<span class="token expression"><span class="token punctuation">$</span>work_version</span>&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="viewbinding"><a href="#viewbinding" class="header-anchor">#</a> ViewBinding</h2> <h3 id="viewbinding-设置"><a href="#viewbinding-设置" class="header-anchor">#</a> ViewBinding 设置</h3> <p>视图绑定功能可按模块启用。要在某个模块中启用视图绑定，请将 <code>viewBinding</code> 元素添加到其 <code>build.gradle</code> 文件中，如下例所示：</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code>android <span class="token punctuation">{</span>
        <span class="token punctuation">...</span>
        viewBinding <span class="token punctuation">{</span>
            enabled <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
</code></pre></div><p>生成绑定类的名称：将 XML 文件的名称转换为驼峰式大小写，并在末尾添加“Binding”一词</p> <p>在生成绑定类时忽略某个布局文件，请将 <code>tools:viewBindingIgnore=&quot;true&quot;</code> 属性添加到相应布局文件的根视图中：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span>
            
            <span class="token attr-name"><span class="token namespace">tools:</span>viewBindingIgnore</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="activity中用法"><a href="#activity中用法" class="header-anchor">#</a> Activity中用法</h3> <p>如需设置绑定类的实例以供 Activity 使用，请在 Activity 的 <a href="https://developer.android.google.cn/reference/kotlin/android/app/Activity#oncreate" target="_blank" rel="noopener noreferrer"><code>onCreate()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法中执行以下步骤：</p> <ol><li>调用生成的绑定类中包含的静态 <code>inflate()</code> 方法。此操作会创建该绑定类的实例以供 Activity 使用。</li> <li>通过调用 <code>getRoot()</code> 方法获取对根视图的引用。</li> <li>将根视图传递到 <a href="https://developer.android.google.cn/reference/kotlin/android/app/Activity#setcontentview_1" target="_blank" rel="noopener noreferrer"><code>setContentView()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，使其成为屏幕上的活动视图。</li></ol> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> binding<span class="token operator">:</span> ResultProfileBinding

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        binding <span class="token operator">=</span> ResultProfileBinding<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>layoutInflater<span class="token punctuation">)</span>
        <span class="token keyword">val</span> view <span class="token operator">=</span> binding<span class="token punctuation">.</span>root
        <span class="token function">setContentView</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="activity基类封装"><a href="#activity基类封装" class="header-anchor">#</a> Activity基类封装</h4> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> BaseVBindingActivity<span class="token operator">&lt;</span>VB <span class="token operator">:</span> ViewBinding<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token keyword">val</span> mVBinding <span class="token operator">:</span>VB <span class="token keyword">by</span> lazy <span class="token punctuation">{</span> <span class="token function">getViewBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>mVBinding<span class="token operator">!!</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">fun</span> <span class="token function">getViewBinding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> VB
<span class="token punctuation">}</span>
</code></pre></div><h3 id="fragment中用法"><a href="#fragment中用法" class="header-anchor">#</a> Fragment中用法</h3> <p>如需设置绑定类的实例以供 Fragment 使用，请在 Fragment 的 <a href="https://developer.android.google.cn/reference/kotlin/androidx/fragment/app/Fragment#oncreateview" target="_blank" rel="noopener noreferrer"><code>onCreateView()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法中执行以下步骤：</p> <ol><li>调用生成的绑定类中包含的静态 <code>inflate()</code> 方法。此操作会创建该绑定类的实例以供 Fragment 使用。</li> <li>通过调用 <code>getRoot()</code> 方法对根视图的引用。</li> <li>从 <code>onCreateView()</code> 方法返回根视图，使其成为屏幕上的活动视图。</li> <li>Fragment的 bingding 需要在视图生命周期销毁时置 null ，Activity不需要。因为 activity 的生命周期和 viewBinding 是同步的。</li></ol> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code> <span class="token keyword">private</span> <span class="token keyword">var</span> _binding<span class="token operator">:</span> ResultProfileBinding<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// This property is only valid between onCreateView and</span>
    <span class="token comment">// onDestroyView.</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> binding <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> _binding<span class="token operator">!!</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>
        inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>
        container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>
        savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> View<span class="token operator">?</span> <span class="token punctuation">{</span>
        _binding <span class="token operator">=</span> ResultProfileBinding<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>inflater<span class="token punctuation">,</span> container<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token keyword">val</span> view <span class="token operator">=</span> binding<span class="token punctuation">.</span>root
        <span class="token keyword">return</span> view
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroyView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroyView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        _binding <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="fragment基类封装"><a href="#fragment基类封装" class="header-anchor">#</a> Fragment基类封装</h4> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">abstract</span> <span class="token keyword">class</span> BaseVBindingFragment<span class="token operator">&lt;</span>VB <span class="token operator">:</span> ViewBinding<span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> _binding <span class="token operator">:</span>VB<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">val</span> vBinding <span class="token operator">:</span>VB <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> _binding<span class="token operator">!!</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>
        inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>
        container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>
        savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> View<span class="token operator">?</span> <span class="token punctuation">{</span>
        _binding <span class="token operator">=</span> <span class="token function">getViewBinding</span><span class="token punctuation">(</span>inflater<span class="token punctuation">,</span> container<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> vBinding<span class="token punctuation">.</span>root
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">fun</span> <span class="token function">getViewBinding</span><span class="token punctuation">(</span>inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span> container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> VB

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroyView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroyView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        _binding <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="livedata概览"><a href="#livedata概览" class="header-anchor">#</a> LiveData概览</h2> <p>LiveData 是一种可观察的数据存储类，具有感知activity fragment更新和service生命周期的能力，能确保只更新处于活跃生命周期状态的应用组件观察者。只有当Obserer类的生命周期处于STARTED或RESUMED状态，LiveData会更新通知。</p> <h3 id="创建livedata"><a href="#创建livedata" class="header-anchor">#</a> 创建LiveData</h3> <p>LiveData 是一种可用于任何数据的封装容器，其中包括可实现 <code>Collections</code> 的对象，如 <code>List</code>。<a href="https://developer.android.google.cn/reference/androidx/lifecycle/LiveData" target="_blank" rel="noopener noreferrer"><code>LiveData</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象通常存储在 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModel" target="_blank" rel="noopener noreferrer"><code>ViewModel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象中，并可通过 getter 方法进行访问，如以下示例中所示：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> NameViewModel <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Create a LiveData with a String</span>
    <span class="token keyword">val</span> currentName<span class="token operator">:</span> MutableLiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>
        MutableLiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Rest of the ViewModel...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="观察livedata"><a href="#观察livedata" class="header-anchor">#</a> 观察LiveData</h3> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> NameActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Use the 'by viewModels()' Kotlin property delegate</span>
    <span class="token comment">// from the activity-ktx artifact</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> model<span class="token operator">:</span> NameViewModel <span class="token keyword">by</span> <span class="token function">viewModels</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>

        <span class="token comment">// Other code to setup the activity...</span>

        <span class="token comment">// Create the observer which updates the UI.</span>
        <span class="token keyword">val</span> nameObserver <span class="token operator">=</span> Observer<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token punctuation">{</span> newName <span class="token operator">-&gt;</span>
            <span class="token comment">// Update the UI, in this case, a TextView.</span>
            nameTextView<span class="token punctuation">.</span>text <span class="token operator">=</span> newName
        <span class="token punctuation">}</span>

        <span class="token comment">// Observe the LiveData, passing in this activity as the LifecycleOwner and the observer.</span>
        model<span class="token punctuation">.</span>currentName<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> nameObserver<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="转换livedata"><a href="#转换livedata" class="header-anchor">#</a> 转换LiveData</h3> <p>您可能希望在将 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/LiveData" target="_blank" rel="noopener noreferrer"><code>LiveData</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象分派给观察者之前对存储在其中的值进行更改，或者您可能需要根据另一个实例的值返回不同的 <code>LiveData</code> 实例。<a href="https://developer.android.google.cn/reference/android/arch/lifecycle/package-summary" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 软件包会提供 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/Transformations" target="_blank" rel="noopener noreferrer"><code>Transformations</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类，该类包括可应对这些情况的辅助程序方法。</p> <ul><li><p>[<code>Transformations.map()</code>](https://developer.android.google.cn/reference/androidx/lifecycle/Transformations#map(android.arch.lifecycle.LiveData, android.arch.core.util.Function))</p> <p>对存储在 <code>LiveData</code> 对象中的值应用函数，并将结果传播到下游。</p></li></ul> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> userLiveData<span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">UserLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> userName<span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token operator">=</span> Transformations<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>userLiveData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    user <span class="token operator">-&gt;</span> <span class="token string-literal singleline"><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">user<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token expression">user<span class="token punctuation">.</span>lastName</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span>
<span class="token punctuation">}</span>
</code></pre></div><p>[<code>Transformations.switchMap()</code>](https://developer.android.google.cn/reference/androidx/lifecycle/Transformations#switchMap(android.arch.lifecycle.LiveData, android.arch.core.util.Function&gt;))</p> <p>与 <code>map()</code> 类似，对存储在 <code>LiveData</code> 对象中的值应用函数，并将结果解封和分派到下游。传递给 <code>switchMap()</code> 的函数必须返回 <code>LiveData</code> 对象，如以下示例中所示：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token keyword">val</span> userId<span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token operator">..</span><span class="token punctuation">.</span>
<span class="token keyword">val</span> user <span class="token operator">=</span> Transformations<span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span> id <span class="token operator">-&gt;</span> <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre></div><p>您可以使用转换方法在观察者的生命周期内传送信息。除非观察者正在观察返回的 <code>LiveData</code> 对象，否则不会计算转换。因为转换是以延迟的方式计算，所以与生命周期相关的行为会隐式传递下去，而不需要额外的显式调用或依赖项。</p> <p>如果您认为 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModel" target="_blank" rel="noopener noreferrer"><code>ViewModel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象中需要有 <code>Lifecycle</code> 对象，那么进行转换或许是更好的解决方案。例如，假设您有一个界面组件，该组件接受地址并返回该地址的邮政编码。您可以为此组件实现简单的 <code>ViewModel</code>，如以下示例代码所示：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> <span class="token function">MyViewModel</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> repository<span class="token operator">:</span> PostalCodeRepository<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">getPostalCode</span><span class="token punctuation">(</span>address<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// DON'T DO THIS</span>
        <span class="token keyword">return</span> repository<span class="token punctuation">.</span><span class="token function">getPostCode</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后，该界面组件需要取消注册先前的 <code>LiveData</code> 对象，并在每次调用 <code>getPostalCode()</code> 时注册到新的实例。此外，如果重新创建了该界面组件，它会再触发一次对 <code>repository.getPostCode()</code> 方法的调用，而不是使用先前调用所得的结果。</p> <p>您也可以将邮政编码查询实现为地址输入的转换，如以下示例中所示：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> <span class="token function">MyViewModel</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> repository<span class="token operator">:</span> PostalCodeRepository<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> addressInput <span class="token operator">=</span> MutableLiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> postalCode<span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token operator">=</span> Transformations<span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span>addressInput<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            address <span class="token operator">-&gt;</span> repository<span class="token punctuation">.</span><span class="token function">getPostCode</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span> <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">setInput</span><span class="token punctuation">(</span>address<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        addressInput<span class="token punctuation">.</span>value <span class="token operator">=</span> address
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这种情况下，<code>postalCode</code> 字段定义为 <code>addressInput</code> 的转换。只要您的应用具有与 <code>postalCode</code> 字段关联的活跃观察者，就会在 <code>addressInput</code> 发生更改时重新计算并检索该字段的值。</p> <p>此机制允许较低级别的应用创建以延迟的方式按需计算的 <code>LiveData</code> 对象。<code>ViewModel</code> 对象可以轻松获取对 <code>LiveData</code> 对象的引用，然后在其基础之上定义转换规则。</p> <h3 id="合并多个-livedata-源"><a href="#合并多个-livedata-源" class="header-anchor">#</a> 合并多个 LiveData 源</h3> <p><a href="https://developer.android.google.cn/reference/androidx/lifecycle/MediatorLiveData" target="_blank" rel="noopener noreferrer"><code>MediatorLiveData</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/LiveData" target="_blank" rel="noopener noreferrer"><code>LiveData</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的子类，允许您合并多个 LiveData 源。只要任何原始的 LiveData 源对象发生更改，就会触发 <code>MediatorLiveData</code> 对象的观察者。</p> <p>例如，如果界面中有可以从本地数据库或网络更新的 <code>LiveData</code> 对象，则可以向 <code>MediatorLiveData</code> 对象添加以下源：</p> <ul><li>与存储在数据库中的数据关联的 <code>LiveData</code> 对象。</li> <li>与从网络访问的数据关联的 <code>LiveData</code> 对象。</li></ul> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> LiveDataVM <span class="token operator">:</span> <span class="token function">ViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> data1 <span class="token operator">:</span> MutableLiveData<span class="token operator">&lt;</span>UserInfo<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">val</span> data2 <span class="token operator">:</span> MutableLiveData<span class="token operator">&lt;</span>UserInfo<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">MutableLiveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">val</span> mediatorMerger <span class="token operator">=</span> MediatorLiveData<span class="token operator">&lt;</span>UserInfo<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//    private val livaDataVm  by lazy { ViewModelProvider(this).get(LiveDataVM::class.java) }</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> liveDataVm  <span class="token keyword">by</span> viewModels<span class="token operator">&lt;</span>LiveDataVM<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> mainBinding <span class="token keyword">by</span> lazy <span class="token punctuation">{</span>
        ActivityMainBinding<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>layoutInflater<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>mainBinding<span class="token punctuation">.</span>root<span class="token punctuation">)</span>
        
        liveDataVm<span class="token punctuation">.</span>mediatorMerger<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span>liveDataVm<span class="token punctuation">.</span>data1<span class="token punctuation">,</span> Observer <span class="token punctuation">{</span>
            liveDataVm<span class="token punctuation">.</span>mediatorMerger<span class="token punctuation">.</span>value <span class="token operator">=</span> it<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        liveDataVm<span class="token punctuation">.</span>mediatorMerger<span class="token punctuation">.</span><span class="token function">addSource</span><span class="token punctuation">(</span>liveDataVm<span class="token punctuation">.</span>data2<span class="token punctuation">,</span> Observer <span class="token punctuation">{</span>
            liveDataVm<span class="token punctuation">.</span>mediatorMerger<span class="token punctuation">.</span>value <span class="token operator">=</span> it<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        liveDataVm<span class="token punctuation">.</span>mediatorMerger<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Observer <span class="token punctuation">{</span>
            mainBinding<span class="token punctuation">.</span>textView2<span class="token punctuation">.</span>text <span class="token operator">=</span> it<span class="token punctuation">.</span>name
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        mainBinding<span class="token punctuation">.</span>btMerge1<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            liveDataVm<span class="token punctuation">.</span>data1<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">UserInfo</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;leo&quot;</span></span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        mainBinding<span class="token punctuation">.</span>btMerge2<span class="token punctuation">.</span><span class="token function">setOnClickListener</span> <span class="token punctuation">{</span>
            liveDataVm<span class="token punctuation">.</span>data2<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">UserInfo</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;tony&quot;</span></span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><h2 id="viewmodel"><a href="#viewmodel" class="header-anchor">#</a> ViewModel</h2> <h3 id="viewmodel-生命周期"><a href="#viewmodel-生命周期" class="header-anchor">#</a> ViewModel 生命周期</h3> <p><a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModel" target="_blank" rel="noopener noreferrer"><code>ViewModel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象存在的时间范围是获取 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModel" target="_blank" rel="noopener noreferrer"><code>ViewModel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 时传递给 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModelProvider" target="_blank" rel="noopener noreferrer"><code>ViewModelProvider</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。<a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModel" target="_blank" rel="noopener noreferrer"><code>ViewModel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将一直留在内存中，直到限定其存在时间范围的 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 永久消失：对于 activity，是在 activity 完成时；而对于 fragment，是在 fragment 分离时。</p> <p>图 1 说明了 Activity 经历屏幕旋转而后结束时所处的各种生命周期状态。该图还在关联的 Activity 生命周期的旁边显示了 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModel" target="_blank" rel="noopener noreferrer"><code>ViewModel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的生命周期。此图表说明了 Activity 的各种状态。这些基本状态同样适用于 Fragment 的生命周期。</p> <p>您通常在系统首次调用 Activity 对象的 <code>onCreate()</code> 方法时请求 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModel" target="_blank" rel="noopener noreferrer"><code>ViewModel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。系统可能会在 activity 的整个生命周期内多次调用 <code>onCreate()</code>，如在旋转设备屏幕时。<a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModel" target="_blank" rel="noopener noreferrer"><code>ViewModel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 存在的时间范围是从您首次请求 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/ViewModel" target="_blank" rel="noopener noreferrer"><code>ViewModel</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 直到 activity 完成并销毁。</p> <p><img src="https://developer.android.google.cn/images/topic/libraries/architecture/viewmodel-lifecycle.png" alt="ViewModel生命周期"></p> <h3 id="viewmodel-实例对象的获取方式"><a href="#viewmodel-实例对象的获取方式" class="header-anchor">#</a> ViewModel 实例对象的获取方式</h3> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> myViewModel1 <span class="token keyword">by</span> viewModels<span class="token operator">&lt;</span>MyViewModel<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//activity-ktx 扩展库提供</span>
<span class="token keyword">val</span> myViewModel2  <span class="token operator">=</span> <span class="token function">ViewModelProvider</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>MyViewModel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//需要在activity onCreated之后调用</span>
<span class="token keyword">val</span> myViewModel3  <span class="token keyword">by</span> <span class="token function">ViewModelLazy</span><span class="token punctuation">(</span>MyViewModel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token punctuation">{</span>viewModelStore<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>defaultViewModelProviderFactory<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//需要在activity onCreated之后调用</span>
<span class="token keyword">val</span> myViewModel4  <span class="token operator">=</span> <span class="token function">ViewModelProvider</span><span class="token punctuation">(</span>viewModelStore<span class="token punctuation">,</span>defaultViewModelProviderFactory<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>MyViewModel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="lifecycle"><a href="#lifecycle" class="header-anchor">#</a> Lifecycle</h2> <p><a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle?hl=zh-cn" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个类，用于存储有关组件（如 Activity 或 Fragment）的生命周期状态的信息，并允许其他对象观察此状态。</p> <p><a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 使用两种主要枚举跟踪其关联组件的生命周期状态：</p> <ul><li><p>事件</p> <p>从框架和 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类分派的生命周期事件。这些事件映射到 Activity 和 Fragment 中的回调事件。</p></li> <li><p>状态</p> <p>由 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象跟踪的组件的当前状态。</p></li></ul> <p><img src="https://developer.android.google.cn/images/topic/libraries/architecture/lifecycle-states.svg" alt="生命周期状态示意图"></p> <h3 id="defaultlifecycleobserver"><a href="#defaultlifecycleobserver" class="header-anchor">#</a> DefaultLifecycleObserver</h3> <p>通过实现 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/DefaultLifecycleObserver" target="_blank" rel="noopener noreferrer"><code>DefaultLifecycleObserver</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 并替换相应的方法（如 <code>onCreate</code> 和 <code>onStart</code> 等）来监控组件的生命周期状态。然后，您可以通过调用 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类的 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle#addObserver(androidx.lifecycle.LifecycleObserver)" target="_blank" rel="noopener noreferrer"><code>addObserver()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法并传递观察器的实例来添加观察器，如下例所示：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> MyObserver <span class="token operator">:</span> DefaultLifecycleObserver <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onResume</span><span class="token punctuation">(</span>owner<span class="token operator">:</span> LifecycleOwner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPause</span><span class="token punctuation">(</span>owner<span class="token operator">:</span> LifecycleOwner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

myLifecycleOwner<span class="token punctuation">.</span><span class="token function">getLifecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token function">MyObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><code>myLifecycleOwner</code> 对象实现了 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleOwner" target="_blank" rel="noopener noreferrer"><code>LifecycleOwner</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 接口，我们将在接下来的部分中对该接口进行说明。</p> <h3 id="lifecycleowner"><a href="#lifecycleowner" class="header-anchor">#</a> LifecycleOwner</h3> <p><a href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleOwner" target="_blank" rel="noopener noreferrer"><code>LifecycleOwner</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是单一方法接口，表示类具有 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。它具有一种方法（即 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleOwner#getLifecycle()" target="_blank" rel="noopener noreferrer"><code>getLifecycle()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>），该方法必须由类实现。</p> <p>此接口从各个类（如 <code>Fragment</code> 和 <code>AppCompatActivity</code>）抽象化 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/Lifecycle" target="_blank" rel="noopener noreferrer"><code>Lifecycle</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的所有权，并允许编写与这些类搭配使用的组件。任何自定义应用类均可实现 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleOwner" target="_blank" rel="noopener noreferrer"><code>LifecycleOwner</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 接口。</p> <p>实现 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/DefaultLifecycleObserver" target="_blank" rel="noopener noreferrer"><code>DefaultLifecycleObserver</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的组件可与实现 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleOwner" target="_blank" rel="noopener noreferrer"><code>LifecycleOwner</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的组件完美配合，因为所有者可以提供生命周期，而观察者可以注册以观察生命周期。</p> <h3 id="实现自定义-lifecycleowner"><a href="#实现自定义-lifecycleowner" class="header-anchor">#</a> 实现自定义 LifecycleOwner</h3> <p>支持库 26.1.0 及更高版本中的 Fragment 和 Activity 已实现 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleOwner" target="_blank" rel="noopener noreferrer"><code>LifecycleOwner</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 接口。</p> <p>如果您有一个自定义类并希望使其成为 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleOwner" target="_blank" rel="noopener noreferrer"><code>LifecycleOwner</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，您可以使用 <a href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleRegistry" target="_blank" rel="noopener noreferrer">LifecycleRegistry<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 类，但需要将事件转发到该类，如以下代码示例中所示：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">class</span> MyActivity <span class="token operator">:</span> <span class="token function">Activity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> LifecycleOwner <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> lifecycleRegistry<span class="token operator">:</span> LifecycleRegistry

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>

        lifecycleRegistry <span class="token operator">=</span> <span class="token function">LifecycleRegistry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        lifecycleRegistry<span class="token punctuation">.</span><span class="token function">markState</span><span class="token punctuation">(</span>Lifecycle<span class="token punctuation">.</span>State<span class="token punctuation">.</span>CREATED<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        lifecycleRegistry<span class="token punctuation">.</span><span class="token function">markState</span><span class="token punctuation">(</span>Lifecycle<span class="token punctuation">.</span>State<span class="token punctuation">.</span>STARTED<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">getLifecycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Lifecycle <span class="token punctuation">{</span>
        <span class="token keyword">return</span> lifecycleRegistry
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="navigation"><a href="#navigation" class="header-anchor">#</a> Navigation</h2> <div class="language-groovy extra-class"><pre class="language-groovy"><code>  <span class="token keyword">def</span> nav_version <span class="token operator">=</span> <span class="token string gstring">&quot;2.4.0&quot;</span>

  <span class="token comment">// Java language implementation</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-fragment:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-ui:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>
  <span class="token comment">// Kotlin</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-fragment-ktx:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>
  implementation <span class="token string gstring">&quot;androidx.navigation:navigation-ui-ktx:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>

<span class="token comment">//如需将 Safe Args 添加到您的项目，请在顶层 build.gradle 文件中包含以下 classpath：</span>
classpath <span class="token string gstring">&quot;androidx.navigation:navigation-safe-args-gradle-plugin:<span class="token expression"><span class="token punctuation">$</span>nav_version</span>&quot;</span>
如需生成适用于 Java 模块或 Java 和 Kotlin 混合模块的 Java 语言代码，请将以下行添加到应用或模块的 build<span class="token punctuation">.</span>gradle 文件中：
plugins <span class="token punctuation">{</span>
  id <span class="token string">'androidx.navigation.safeargs'</span>
<span class="token punctuation">}</span>
此外，如需生成适用于仅 Kotlin 模块的 Kotlin 语言代码，请添加以下行
plugins <span class="token punctuation">{</span>
  id <span class="token string">'androidx.navigation.safeargs.kotlin'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="向-activity-添加-navhost"><a href="#向-activity-添加-navhost" class="header-anchor">#</a> 向 Activity 添加 NavHost</h3> <p>导航宿主必须派生于 <a href="https://developer.android.google.cn/reference/androidx/navigation/NavHost" target="_blank" rel="noopener noreferrer"><code>NavHost</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。Navigation 组件的默认 <code>NavHost</code> 实现 (<a href="https://developer.android.google.cn/reference/androidx/navigation/fragment/NavHostFragment" target="_blank" rel="noopener noreferrer"><code>NavHostFragment</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) 负责处理 fragment 目的地的交换。</p> <h3 id="通过-xml-添加-navhostfragment"><a href="#通过-xml-添加-navhostfragment" class="header-anchor">#</a> 通过 XML 添加 NavHostFragment</h3> <p>以下 XML 示例显示了作为应用主 Activity 一部分的 <code>NavHostFragment</code>：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.MainActivity<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.appcompat.widget.Toolbar</span>
        <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.fragment.app.FragmentContainerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/nav_host_fragment<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>androidx.navigation.fragment.NavHostFragment<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0dp<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0dp<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintLeft_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintRight_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>defaultNavHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>navGraph</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@navigation/nav_graph<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.bottomnavigation.BottomNavigationView</span>
        <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>android:name</code> 属性包含 <code>NavHost</code> 实现的类名称。</li> <li><code>app:navGraph</code> 属性将 <code>NavHostFragment</code> 与导航图相关联。导航图会在此 <code>NavHostFragment</code> 中指定用户可以导航到的所有目的地。</li> <li><code>app:defaultNavHost=&quot;true&quot;</code> 属性确保您的 <code>NavHostFragment</code> 会拦截系统返回按钮。请注意，只能有一个默认 <code>NavHost</code>。如果同一布局（例如，双窗格布局）中有多个宿主，请务必仅指定一个默认 <code>NavHost</code>。</li></ul> <h3 id="导航到目的地"><a href="#导航到目的地" class="header-anchor">#</a> 导航到目的地</h3> <p>导航到目的地是使用 <a href="https://developer.android.google.cn/reference/androidx/navigation/NavController" target="_blank" rel="noopener noreferrer"><code>NavController</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 完成的，它是一个在 <code>NavHost</code> 中管理应用导航的对象。每个 <code>NavHost</code> 均有自己的相应 <code>NavController</code>。您可以使用以下方法之一检索 <code>NavController</code>：</p> <p><strong>Kotlin</strong>：</p> <ul><li><a href="https://developer.android.google.cn/reference/kotlin/androidx/navigation/fragment/package-summary#(androidx.fragment.app.Fragment).findNavController()" target="_blank" rel="noopener noreferrer"><code>Fragment.findNavController()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.android.google.cn/reference/kotlin/androidx/navigation/package-summary#(android.view.View).findNavController()" target="_blank" rel="noopener noreferrer"><code>View.findNavController()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.android.google.cn/reference/kotlin/androidx/navigation/package-summary#(android.app.Activity).findNavController(kotlin.Int)" target="_blank" rel="noopener noreferrer"><code>Activity.findNavController(viewId: Int)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><strong>Java</strong>：</p> <ul><li><a href="https://developer.android.google.cn/reference/androidx/navigation/fragment/NavHostFragment#findNavController(android.support.v4.app.Fragment)" target="_blank" rel="noopener noreferrer"><code>NavHostFragment.findNavController(Fragment)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>[<code>Navigation.findNavController(Activity, @IdRes int viewId)</code>](https://developer.android.google.cn/reference/androidx/navigation/Navigation#findNavController(android.app.Activity, int))</li> <li><a href="https://developer.android.google.cn/reference/androidx/navigation/Navigation#findNavController(android.view.View)" target="_blank" rel="noopener noreferrer"><code>Navigation.findNavController(View)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> navHostFragment <span class="token operator">=</span>
        supportFragmentManager<span class="token punctuation">.</span><span class="token function">findFragmentById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>nav_host_fragment<span class="token punctuation">)</span> <span class="token keyword">as</span> NavHostFragment
<span class="token keyword">val</span> navController <span class="token operator">=</span> navHostFragment<span class="token punctuation">.</span>navController
</code></pre></div><p>检索 <code>NavController</code> 之后，您可以调用 <a href="https://developer.android.google.cn/reference/androidx/navigation/NavController#navigate(androidx.navigation.NavDirections)" target="_blank" rel="noopener noreferrer"><code>navigate()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的某个重载，以在各个目的地之间导航。每个重载均支持多种导航场景</p> <h3 id="目的地之间传递数据"><a href="#目的地之间传递数据" class="header-anchor">#</a> 目的地之间传递数据</h3> <h4 id="定义目的地参数"><a href="#定义目的地参数" class="header-anchor">#</a> 定义目的地参数</h4> <p>如需在目的地之间传递数据，首先请按照以下步骤将参数添加到接收它的目的地来定义参数：</p> <ol><li>在 <a href="https://developer.android.google.cn/topic/libraries/architecture/navigation/navigation-implementing" target="_blank" rel="noopener noreferrer">Navigation Editor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中，点击接收参数的目的地。</li> <li>在 <strong>Attributes</strong> 面板中，点击 <strong>Add</strong> (<strong>+</strong>)。</li> <li>在显示的 <strong>Add Argument Link</strong> 窗口中，输入参数名称、参数类型、参数是否可为 null，以及默认值（如果需要）。</li> <li>点击 <strong>Add</strong>。请注意，该参数现在会显示在 <strong>Attributes</strong> 面板的 <strong>Arguments</strong> 列表中。</li> <li>接下来，点击会将您转到此目的地的相应操作。在 <strong>Attributes</strong> 面板中，您现在应该会在 <strong>Argument Default Values</strong> 部分中看到新添加的参数。</li> <li>您还可以看到该参数已添加到 XML 中。点击 <strong>Text</strong> 标签页以切换到 XML 视图，就会发现您的参数已添加到接收该参数的目的地。相关示例如下所示：</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fragment</span> <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/myFragment<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>argument</span>
         <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myArg<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">app:</span>argType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>integer<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">android:</span>defaultValue</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fragment</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="支持的参数类型"><a href="#支持的参数类型" class="header-anchor">#</a> 支持的参数类型</h4> <p>Navigation 库支持以下参数类型：</p> <table><thead><tr><th style="text-align:left;">类型</th> <th style="text-align:left;">app:argType 语法</th> <th style="text-align:left;">是否支持默认值？</th> <th style="text-align:left;">是否由路由处理？</th> <th style="text-align:left;">是否可为 null？</th></tr></thead> <tbody><tr><td style="text-align:left;">整数</td> <td style="text-align:left;">app:argType=&quot;integer&quot;</td> <td style="text-align:left;">是</td> <td style="text-align:left;">是</td> <td style="text-align:left;">否</td></tr> <tr><td style="text-align:left;">浮点数</td> <td style="text-align:left;">app:argType=&quot;float&quot;</td> <td style="text-align:left;">是</td> <td style="text-align:left;">是</td> <td style="text-align:left;">否</td></tr> <tr><td style="text-align:left;">长整数</td> <td style="text-align:left;">app:argType=&quot;long&quot;</td> <td style="text-align:left;">是 - 默认值必须始终以“L”后缀结尾（例如“123L”）。</td> <td style="text-align:left;">是</td> <td style="text-align:left;">否</td></tr> <tr><td style="text-align:left;">布尔值</td> <td style="text-align:left;">app:argType=&quot;boolean&quot;</td> <td style="text-align:left;">是 -“true”或“false”</td> <td style="text-align:left;">是</td> <td style="text-align:left;">否</td></tr> <tr><td style="text-align:left;">字符串</td> <td style="text-align:left;">app:argType=&quot;string&quot;</td> <td style="text-align:left;">是</td> <td style="text-align:left;">是</td> <td style="text-align:left;">是</td></tr> <tr><td style="text-align:left;">资源引用</td> <td style="text-align:left;">app:argType=&quot;reference&quot;</td> <td style="text-align:left;">是 - 默认值必须为“@resourceType/resourceName”格式（例如，“@style/myCustomStyle”）或“0”</td> <td style="text-align:left;">是</td> <td style="text-align:left;">否</td></tr> <tr><td style="text-align:left;">自定义 Parcelable</td> <td style="text-align:left;">app:argType=&quot;&lt;type&gt;&quot;，其中 &lt;type&gt; 是 <code>Parcelable</code> 的完全限定类名称</td> <td style="text-align:left;">支持默认值“@null”。不支持其他默认值。</td> <td style="text-align:left;">否</td> <td style="text-align:left;">是</td></tr> <tr><td style="text-align:left;">自定义 Serializable</td> <td style="text-align:left;">app:argType=&quot;&lt;type&gt;&quot;，其中 &lt;type&gt; 是 <code>Serializable</code> 的完全限定类名称</td> <td style="text-align:left;">支持默认值“@null”。不支持其他默认值。</td> <td style="text-align:left;">否</td> <td style="text-align:left;">是</td></tr> <tr><td style="text-align:left;">自定义 Enum</td> <td style="text-align:left;">app:argType=&quot;&lt;type&gt;&quot;，其中 &lt;type&gt; 是 Enum 的完全限定名称</td> <td style="text-align:left;">是 - 默认值必须与非限定名称匹配（例如，“SUCCESS”匹配 MyEnum.SUCCESS）。</td> <td style="text-align:left;">否</td> <td style="text-align:left;">否</td></tr></tbody></table> <p><strong>注意</strong>：仅在引用类型中支持对资源的引用。在其他任何类型中使用资源引用都会导致异常。</p> <h4 id="使用-safe-args-传递安全的数据"><a href="#使用-safe-args-传递安全的数据" class="header-anchor">#</a> 使用 Safe Args 传递安全的数据</h4> <p>启用 Safe Args 后，生成的代码会为每个操作包含以下类型安全的类和方法，以及每个发送和接收目的地。</p> <ul><li><p>为生成操作的每一个目的地创建一个类。该类的名称是在源目的地的名称后面加上“Directions”。例如，如果源目的地是名为 <code>SpecifyAmountFragment</code> 的 Fragment，则生成的类的名称为 <code>SpecifyAmountFragmentDirections</code>。</p> <p>该类会为源目的地中定义的每个操作提供一个方法。</p></li> <li><p>对于用于传递参数的每个操作，都会创建一个 inner 类，该类的名称根据操作的名称确定。例如，如果操作名称为 <code>confirmationAction,</code>，则类名称为 <code>ConfirmationAction</code>。如果您的操作包含不带 <code>defaultValue</code> 的参数，则您可以使用关联的 action 类来设置参数值。</p></li> <li><p>为接收目的地创建一个类。该类的名称是在目的地的名称后面加上“Args”。例如，如果目的地 Fragment 的名称为 <code>ConfirmationFragment,</code>，则生成的类的名称为 <code>ConfirmationFragmentArgs</code>。可以使用该类的 <code>fromBundle()</code> 方法检索参数。</p></li></ul> <p>以下示例说明了如何使用这些方法来设置参数并将其传递给 <a href="https://developer.android.google.cn/reference/androidx/navigation/NavController#navigate(int)" target="_blank" rel="noopener noreferrer"><code>navigate()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法：</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onClick</span><span class="token punctuation">(</span>v<span class="token operator">:</span> View<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">val</span> amountTv<span class="token operator">:</span> EditText <span class="token operator">=</span> view<span class="token operator">!!</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>editTextAmount<span class="token punctuation">)</span>
   <span class="token keyword">val</span> amount <span class="token operator">=</span> amountTv<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">val</span> action <span class="token operator">=</span> SpecifyAmountFragmentDirections<span class="token punctuation">.</span><span class="token function">confirmationAction</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span>
   v<span class="token punctuation">.</span><span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在接收目的地的代码中，请使用 <a href="https://developer.android.google.cn/reference/androidx/fragment/app/Fragment#getArguments()" target="_blank" rel="noopener noreferrer"><code>getArguments()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法来检索 bundle 并使用其内容。使用 <code>-ktx</code> 依赖项时，Kotlin 用户还可以使用 <code>by navArgs()</code> 属性委托来访问参数。</p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> args<span class="token operator">:</span> ConfirmationFragmentArgs <span class="token keyword">by</span> <span class="token function">navArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onViewCreated</span><span class="token punctuation">(</span>view<span class="token operator">:</span> View<span class="token punctuation">,</span> savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> tv<span class="token operator">:</span> TextView <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>textViewAmount<span class="token punctuation">)</span>
    <span class="token keyword">val</span> amount <span class="token operator">=</span> args<span class="token punctuation">.</span>amount
    tv<span class="token punctuation">.</span>text <span class="token operator">=</span> amount<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="将-safe-args-用于全局操作"><a href="#将-safe-args-用于全局操作" class="header-anchor">#</a> 将 Safe Args 用于全局操作</h4> <p>将 Safe Args 用于<a href="https://developer.android.google.cn/topic/libraries/architecture/navigation/navigation-global-action" target="_blank" rel="noopener noreferrer">全局操作<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>时，您必须为根 <code>&lt;navigation&gt;</code> 元素提供一个 <code>android:id</code> 值，如以下示例中所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigation</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/main_nav<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>startDestination</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@id/mainFragment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    ...

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigation</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Navigation 会根据 <code>android:id</code> 值为 <code>&lt;navigation&gt;</code> 元素生成一个 <code>Directions</code> 类。例如，如果您有具有 <code>android:id=@+id/main_nav</code> 的 <code>&lt;navigation&gt;</code> 元素，则生成的类的名称为 <code>MainNavDirections</code>。<code>&lt;navigation&gt;</code> 元素中的所有目的地都生成了方法，以使用前一节中所述的相同方法来访问所有关联的全局操作。</p> <h4 id="使用-bundle-对象在目的地之间传递参数"><a href="#使用-bundle-对象在目的地之间传递参数" class="header-anchor">#</a> 使用 Bundle 对象在目的地之间传递参数</h4> <p>如果您不使用 Gradle，仍然可以使用 <code>Bundle</code> 对象在目的地之间传递参数。创建 <code>Bundle</code> 对象并使用 <a href="https://developer.android.google.cn/reference/androidx/navigation/NavController#navigate(int)" target="_blank" rel="noopener noreferrer"><code>navigate()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 将它传递给目的地，如下所示：</p> <p><a href="https://developer.android.google.cn/guide/navigation/navigation-pass-data#kotlin" target="_blank" rel="noopener noreferrer">Kotlin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://developer.android.google.cn/guide/navigation/navigation-pass-data#java" target="_blank" rel="noopener noreferrer">Java<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> bundle <span class="token operator">=</span> <span class="token function">bundleOf</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;amount&quot;</span></span> <span class="token keyword">to</span> amount<span class="token punctuation">)</span>
view<span class="token punctuation">.</span><span class="token function">findNavController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>confirmationAction<span class="token punctuation">,</span> bundle<span class="token punctuation">)</span>
</code></pre></div><p>在接收目的地的代码中，请使用 <a href="https://developer.android.google.cn/reference/androidx/fragment/app/Fragment#getArguments()" target="_blank" rel="noopener noreferrer"><code>getArguments()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法来检索 <code>Bundle</code> 并使用其内容：</p> <p><a href="https://developer.android.google.cn/guide/navigation/navigation-pass-data#kotlin" target="_blank" rel="noopener noreferrer">Kotlin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://developer.android.google.cn/guide/navigation/navigation-pass-data#java" target="_blank" rel="noopener noreferrer">Java<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-kotlin extra-class"><pre class="language-kotlin"><code><span class="token keyword">val</span> tv <span class="token operator">=</span> view<span class="token punctuation">.</span>findViewById<span class="token operator">&lt;</span>TextView<span class="token operator">&gt;</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>textViewAmount<span class="token punctuation">)</span>
tv<span class="token punctuation">.</span>text <span class="token operator">=</span> arguments<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;amount&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><h3 id="嵌套图-多返回栈"><a href="#嵌套图-多返回栈" class="header-anchor">#</a> 嵌套图 多返回栈</h3> <p>自 2.4.0 版本开始 navigation 支持使用 <code>setupWithNavController</code> 时保存并恢复每个菜单项的状态。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigation</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/tools<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/mobile_navigation<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">app:</span>startDestination</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@id/nav_home<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> //使用id

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name"><span class="token namespace">app:</span>graph</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@navigation/nav_home<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name"><span class="token namespace">app:</span>graph</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@navigation/nav_dashboard<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name"><span class="token namespace">app:</span>graph</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@navigation/nav_notifications<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigation</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>结合 BottomNavigationView 使用 ，BottomNavigationView 的 menu item id 必须与 导航图的 id 保持一致，否则 setupWithNavController 无法与 navigation 正确绑定使用</p> <div class="language-xml extra-class"><pre class="language-xml"><code>    <span class="token comment">&lt;!--与导航图的id保持一致--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/nav_home<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@drawable/ic_home_black_24dp<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/title_home<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!--    &lt;item--&gt;</span>
<span class="token comment">&lt;!--        android:id=&quot;@+id/nav_dashboard&quot;--&gt;</span>
<span class="token comment">&lt;!--        android:icon=&quot;@drawable/ic_dashboard_black_24dp&quot;--&gt;</span>
<span class="token comment">&lt;!--        android:title=&quot;@string/title_dashboard&quot; /&gt;--&gt;</span>

<span class="token comment">&lt;!--    &lt;item--&gt;</span>
<span class="token comment">&lt;!--        android:id=&quot;@+id/nav_notifications&quot;--&gt;</span>
<span class="token comment">&lt;!--        android:icon=&quot;@drawable/ic_notifications_black_24dp&quot;--&gt;</span>
<span class="token comment">&lt;!--        android:title=&quot;@string/title_notifications&quot; /&gt;--&gt;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/StudyRecord/guide/android/AndroidView.html">
        Android常用控件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/StudyRecord/assets/js/app.9fe21fb7.js" defer></script><script src="/StudyRecord/assets/js/2.711b5d2d.js" defer></script><script src="/StudyRecord/assets/js/12.94471144.js" defer></script>
  </body>
</html>
